package:
  name: inbound-agent
  version: 3077.vd69cf116da_6f-3
  epoch: 0
  description: a Jenkins agent which can connect to Jenkins using TCP or Websocket protocols
  target-architecture:
    - all
  copyright:
    - paths:
      - "*"
      attestation: TODO
      license: MIT
  dependencies:
    runtime:
      - ca-certificates-bundle
      - openjdk-17-jre

environment:
  contents:
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    repositories:
      - https://packages.wolfi.dev/os
    packages:
      - ca-certificates-bundle
      - busybox

pipeline:
  - uses: fetch
    with:
      uri: https://github.com/jenkinsci/docker-inbound-agent/archive/refs/tags/${{package.version}}.tar.gz
      expected-sha256: 9b24f3eb7e6618e92ef1ba410a29f2590766a264e8c8adff8f2163a267086af1
  - uses: fetch
    with:
      # version of agent and the jar file is different so hardcode for now
      uri: https://repo.jenkins-ci.org/public/org/jenkins-ci/main/remoting/3077.vd69cf116da_6f/remoting-3077.vd69cf116da_6f.jar
      expected-sha256: 933bb67df903ff325e8b29083b39f9c33394d84d8e3eed836ce981e6bb5834d6
      extract: false
  - runs: |
      mkdir -p "${{targets.destdir}}"/usr/local/bin
      cp ./jenkins-agent "${{targets.destdir}}"/usr/local/bin
      ln -n "${{targets.destdir}}"/usr/local/bin/jenkins-agent "${{targets.destdir}}"/usr/local/bin/jenkins-slave
      
      mkdir -p "${{targets.destdir}}"/usr/share/jenkins
      cp ./remoting-3077.vd69cf116da_6f.jar "${{targets.destdir}}"/usr/share/jenkins/agent.jar

      chmod 0644 "${{targets.destdir}}"/usr/share/jenkins/agent.jar

      ln -sf "${{targets.destdir}}"/usr/share/jenkins/agent.jar "${{targets.destdir}}"/usr/share/jenkins/slave.jar
